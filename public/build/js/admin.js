const cita={nombre:"",fecha:"",hora:"",serviciosDeseados:[],total:"",demoraTotal:"",usuarioId:"",direccion:""};function iniciarApp(){seleccionarFecha(),seleccionarHora()}function seleccionarHora(){document.querySelector("#hora").addEventListener("input",(function(e){const r=e.target.value;let t=0;const a=document.querySelector("#demora").value.split(":"),o=a[0],n=a[1];t=2*parseInt(o),30==parseInt(n)?t++:45==parseInt(n)&&(t+=2),console.log(t);const c=e.target.value.split(":"),i="#t"+c[0]+c[1];let l=document.querySelector(i),s=!1,u=1;for(;!s&&null!=l;)null!=l.nextElementSibling&&(l.nextElementSibling.disabled?s=!0:u++),l=l.nextElementSibling;if(errorDisponible=document.querySelector("#errorDisponible"),u<t){if(e.target.value="",cita.hora="",errorDisponible)return;alerta=crearAlerta("Elije otro horario/fecha, el tiempo de tu cita excede el disponible","error","errorDisponible"),mostrarAlerta("#tituloEditarFecha",alerta)}else{const t=r.split(":")[0];if(errorHora=document.querySelector("#errorHora"),t<10||t>19){if(e.target.value="",errorHora)return;alerta=crearAlerta("Debes seleccionar una hora entre las 10am y 19:30pm","error","errorHora"),mostrarAlerta("#tituloEditarFecha",alerta)}else errorHora&&errorHora.remove(),errorDisponible&&errorDisponible.remove(),cita.hora=e.target.value}}))}async function actualizarReservas(e){cita.fecha=e?e.target.value:document.querySelector("#fecha").value;document.querySelectorAll("option").forEach(e=>{e.textContent=e.textContent.substring(0,5),e.disabled=!1});try{const e=window.location.origin+"/api/citas-fecha?fecha="+cita.fecha,r=await fetch(e),t=await r.json();t.length>0&&t.forEach(e=>{const r=e.hora.split(":"),t="#t"+r[0]+r[1];let a=document.querySelector(t);let o=0;const n=e.demoraTotal.substring(0,5).split(":");"00"!=n[0]&&(o+=2*n[0].charAt(1)),"00"!=n[1]&&("45"==n[1]&&(o+=1),o+=1);let c=0;for(;c<o;)a.textContent=a.textContent+" RESERVADO",a.disabled=!0,a=a.nextElementSibling,c++})}catch(e){}}function seleccionarFecha(){document.querySelector("#fecha").addEventListener("input",(function(e){advertenciaFecha=document.querySelector("#advertenciaFecha"),errorFecha=document.querySelector("#errorFecha"),errorFecha&&errorFecha.remove(),advertenciaFecha&&advertenciaFecha.remove();const r=new Date(e.target.value).getUTCDay();if(errorFecha=document.querySelector("#errorFecha"),[6,0].includes(r)){if(e.target.value="",errorFecha)return;alerta=crearAlerta("Fines de semana no permitidos","error","errorFecha"),mostrarAlerta("#tituloEditarFecha",alerta)}else actualizarReservas(e)}))}function crearAlerta(e,r,t=null){const a=document.createElement("DIV");return a.textContent=e,a.classList.add("alerta"),a.classList.add(r),a.setAttribute("id",t),a}function mostrarAlerta(e,r){let t=document.querySelector("#"+r.id);t?t.remove():(t=document.querySelector("."+r.class),t&&t.remove());document.querySelector(e).appendChild(r)}document.addEventListener("DOMContentLoaded",(function(){actualizarReservas(),iniciarApp()}));